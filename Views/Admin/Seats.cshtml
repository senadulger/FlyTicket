@model List<Dictionary<string, object>>

@{
    // Sayfa başlığı
    ViewData["Title"] = "Koltuklar";

    // Filtrelenmiş uçak adı
    string planeName = ViewBag.FilterPlaneName as string;
}

<div class="container mt-4">

    <!-- Sayfa başlığı ve filtreli uçak adı -->
    <h2>
        Koltuklar
        @if (!string.IsNullOrEmpty(planeName))
        {
            <span class="text-muted">- @planeName</span> @* Hangi uçağın koltukları görüntüleniyor *@
        }
    </h2>

    @* TempData mesajları *@
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success mt-3">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger mt-3">@TempData["Error"]</div>
    }

    @* Belirli bir uçak için filtrelenmişse, üstte koltuk ekleme formu göster *@
    @if (ViewBag.FilterPlaneId != null)
    {
        <div class="mb-3">

            <!-- Koltuk ekleme formu: AdminController -> AddSeat (POST) -->
            <form asp-controller="Admin" asp-action="AddSeat" method="post" class="row g-2">

                @Html.AntiForgeryToken()

                <!-- Koltuğun ekleneceği uçak ID'si -->
                <input type="hidden" name="planeId" value="@(ViewBag.FilterPlaneId)" />

                <!-- Koltuk numarası girişi -->
                <div class="col-md-4 col-lg-3">
                    <input type="text" class="form-control" name="seatNumber" placeholder="Koltuk No" required />
                </div>

                <!-- Koltuk sınıfı seçimi (0: Ekonomi, 1: Business) -->
                <div class="col-md-3 col-lg-2">
                    <select class="form-select" name="seatClass">
                        <option value="0">Ekonomi</option>
                        <option value="1">Business</option>
                    </select>
                </div>

                <!-- Formu gönderme butonu -->
                <div class="col-md-3 col-lg-2">
                    <button type="submit" class="btn btn-primary">Koltuk Ekle</button>
                </div>
            </form>
        </div>
    }

    <!-- Model boşsa bilgilendirme -->
    @if (Model == null || Model.Count == 0)
    {
        <div class="alert alert-info mt-3">
            Kayıtlı koltuk bulunmamaktadır.
        </div>
    }
    else
    {
        <div class="table-responsive">

            <!-- Koltuk listesi tablosu -->
            <table class="table table-custom mb-0">

                <!-- Tablo başlıkları -->
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Koltuk No</th>
                        <th>Sınıf</th>
                        <th>Uçak</th>
                        <th style="width:120px;">İşlemler</th>
                    </tr>
                </thead>

                <!-- Tablo içerik alanı -->
                <tbody>
                    @foreach (var row in Model)
                    {
                        @* class alanı numeric geldiği için int'e çevrilir *@
                        var cls = Convert.ToInt32(row["class"]);

                        @* class değerine göre metin ve badge rengi belirlenir *@
                        var classText = cls == 1 ? "Business" : "Ekonomi";
                        var badgeClass = cls == 1 ? "bg-danger" : "bg-info";

                        <tr>
                            <td>@row["id"]</td>
                            <td class="fw-bold">@row["seat_number"]</td>

                            <!-- Koltuk sınıfı badge ile gösterilir -->
                            <td>
                                <span class="badge @badgeClass">@classText</span>
                            </td>

                            <!-- Uçağın adı -->
                            <td>@row["plane_name"]</td>

                            <!-- Silme işlemi -->
                            <td>
                                <form asp-controller="Admin" asp-action="DeleteSeat" method="post" style="display:inline">

                                    @Html.AntiForgeryToken()

                                    <!-- Silinecek koltuğun ID'si -->
                                    <input type="hidden" name="id" value="@(row["id"])" />

                                    <!-- Silme sonrası aynı uçak filtresine geri dönmek için planeId gönderilir -->
                                    <input type="hidden" name="planeId"
                                        value="@(ViewBag.FilterPlaneId ?? Convert.ToInt32(row["plane_id"]))" />

                                    <!-- Sil butonu -->
                                    <button type="submit" class="btn-action-delete"
                                        onclick="return confirm('Bu koltuğu silmek istiyor musunuz?');">
                                        Sil
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>