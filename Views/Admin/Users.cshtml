@model List<Dictionary<string, object>>

@{
    // Sayfa başlığı
    ViewData["Title"] = "Kullanıcılar";
}

<div class="container mt-4">
    <h2>Kullanıcılar</h2>

    <!-- Başarı mesajı -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success mt-3">@TempData["Success"]</div>
    }

    <!-- Hata mesajı -->
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger mt-3">@TempData["Error"]</div>
    }

    <!-- Model boşsa bilgilendirme -->
    @if (Model == null || Model.Count == 0)
    {
        <div class="alert alert-info mt-3">
            Kayıtlı kullanıcı bulunmamaktadır.
        </div>
    }
    else
    {
        <div class="table-responsive">

            <!-- Kullanıcı listesi tablosu -->
            <table class="table table-custom mb-0">

                <!-- Tablo başlıkları -->
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>TC No</th>
                        <th>Ad - Soyad</th>
                        <th>E-posta</th>
                        <th>Doğum Tarihi</th>
                        <th>Telefon</th>
                        <th>Rol</th>
                    </tr>
                </thead>

                <!-- Tablo içerik alanı -->
                <tbody>
                    @foreach (var row in Model)
                    {
                        @* role alanı numeric geldiği için int'e çevrilir (1: Admin, diğer: Kullanıcı) *@
                        var roleVal = Convert.ToInt32(row["role"]);
                        var roleName = roleVal == 1 ? "Admin" : "Kullanıcı";
                        var roleBadge = roleVal == 1 ? "bg-danger" : "bg-info";

                        @* Doğum tarihi null gelebileceği için kontrol edilir *@
                        var birthDate = row["birth_date"] != DBNull.Value
                        ? Convert.ToDateTime(row["birth_date"]).ToString("dd.MM.yyyy")
                        : "-";

                        @* Ad ve Soyad birleştirilir *@
                        var fullName = $"{row["first_name"]} {row["last_name"]}";

                        <tr>
                            <!-- Kullanıcı bilgileri -->
                            <td>@row["id"]</td>
                            <td>@row["tc_no"]</td>
                            <td class="fw-medium">@fullName</td>
                            <td>@row["mail"]</td>
                            <td>@birthDate</td>
                            <td>@row["phone"]</td>

                            <!-- Rol badge ile gösterilir -->
                            <td>
                                <span class="badge @roleBadge">@roleName</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>